<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>How to export nvd3 chart to PNG | Hui&#39;s blog</title>
  <meta name="author" content="Hui">
  
  <meta name="description" content="Recently I was working on NVD3. I got a task to export nvd3 chart to PNG file.It needs to support IE9+, Chrome, Firefox. I encountered some problems w">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="How to export nvd3 chart to PNG"/>
  <meta property="og:site_name" content="Hui&#39;s blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hui&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Hui&#39;s blog</a></h1>
  <h2><a href="/">Make progress a little bit every day</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/abouts.html">About</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-03-28T12:41:23.000Z"><a href="/2015/03/28/svg-to-png/">2015-03-28</a></time>
      
      
  
    <h1 class="title">How to export nvd3 chart to PNG</h1>
  

    </header>
    <div class="entry">
      
        <p>Recently I was working on NVD3. I got a task to export <a href="https://github.com/novus/nvd3" target="_blank" rel="external">nvd3</a> chart to PNG file.<br>It needs to support IE9+, Chrome, Firefox. I encountered some problems when I was doing this task, it took me some time to figure it out. I think it is better to share my experience for who has similar requirements.<br><em>nvd3</em> is base on <a href="http://d3js.org/" target="_blank" rel="external">d3js</a>. <em>d3js</em> uses SVG to render data. So the key issue is how to covert SVG to PNG, and the other issue is how to download the PNG file.</p>
<h2 id="Solution_1:_send_SVG_to_Server_,_convert_it_to_PNG_and_generate_link_to_download">Solution 1: send SVG  to Server , convert it to PNG and generate link to download</h2><p>Our server-side is Asp.net, so I did some research how to convert SVG to PNG on .net. I got three options,<a href="https://github.com/vvvv/SVG" target="_blank" rel="external">SVG.NET</a>,<a href="http://imagemagick.codeplex.com/" target="_blank" rel="external"> ImageMagick.NET</a>,<a href="https://inkscape.org/" target="_blank" rel="external">inkscape</a>.<br>I tried them out, but no one can generate the PNG perfectly. The <em>nvd3</em> uses some CSS class for SVG, but <em>SVG.NET</em> and <em>mageMagick.NET</em> don’t support it very well. And the PNG file that <em>inkscape</em> generates are  different with browsers render. I tried to add the styles to SVG file manually without CSS, but PNG file they generated still looks different with browsers render.<br>Finally I found <a href="http://phantomjs.org/" target="_blank" rel="external">PhantomJs</a> out. <em>PhantomJS</em> is a headless WebKit scriptable with a JavaScript API. <em>PhantomJS</em> is a perfect solution to render SVG and can export to image and PDF. It can generate PNG exactly same with browsers render. But I have to install it on the server and write some API to call it.<br><strong>I discussed with my leader, but she didn’t like this solution, so I have to turn to Solution 2.</strong></p>
<h2 id="Solution_2:_convert_SVG_to_html5_canvas_,_then_convert_canvas_to_PNG_and_download_it">Solution 2: convert SVG to html5 canvas , then convert canvas to PNG and download it</h2><h3 id="Step_1:_convert_SVG_to_canvas">Step 1: convert SVG to canvas</h3><p><a href="https://github.com/exupero/saveSvgAsPng" target="_blank" rel="external">saveSvgAsPng</a> is a library to export SVG to PNG on the client-side. But unfortunately, it doesn’t work on IE and safari. There is a security error on IE. And besides,It can’t download the PNG file on safari, safari open the file on the new tab instead of downloading it. So I have to give up this scenario.<br>And then I found <a href="https://github.com/gabelerner/canvg" target="_blank" rel="external">canvg</a> out, <em>canvg</em> can parse SVG and render it on Canvas. But <em>canvg </em>doesn’t support external CSS on the SVG.<br>Eventually I was inspired by the <em>saveSvgAsPng</em>. <em>saveSvgAsPng</em> will read the used external CSS for SVG and put it into the SVG. So I create a new function in <em>saveSvgAsPng</em> called <strong>saveAsSVGWithStyle</strong>.It will return a new SVG with CSS.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">out$.saveAsSVGWithStyle = <span class="function"><span class="keyword">function</span> <span class="params">(el, options, cb)</span> </span>&#123;</span><br><span class="line">      options = options || &#123;&#125;;</span><br><span class="line">      options.scale = options.scale || <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">var</span> xmlns = <span class="string">"http://www.w3.org/2000/xmlns/"</span>;</span><br><span class="line"></span><br><span class="line">      inlineImages(el, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> outer = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">          <span class="keyword">var</span> clone = el.cloneNode(<span class="literal">true</span>);</span><br><span class="line">          <span class="keyword">var</span> width, height;</span><br><span class="line">          <span class="keyword">if</span>(el.tagName == <span class="string">'svg'</span>) &#123;</span><br><span class="line">              width = <span class="built_in">parseInt</span>(clone.getAttribute(<span class="string">'width'</span>) || clone.style.width || out$.getComputedStyle(el).getPropertyValue(<span class="string">'width'</span>));</span><br><span class="line">              height = <span class="built_in">parseInt</span>(clone.getAttribute(<span class="string">'height'</span>) || clone.style.height || out$.getComputedStyle(el).getPropertyValue(<span class="string">'height'</span>));</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">var</span> box = el.getBBox();</span><br><span class="line">              width = box.x + box.width;</span><br><span class="line">              height = box.y + box.height;</span><br><span class="line">              clone.setAttribute(<span class="string">'transform'</span>, clone.getAttribute(<span class="string">'transform'</span>).replace(<span class="regexp">/translate\(.*?\)/</span>, <span class="string">''</span>));</span><br><span class="line"></span><br><span class="line">              <span class="keyword">var</span> svg = <span class="built_in">document</span>.createElementNS(<span class="string">'http://www.w3.org/2000/svg'</span>,<span class="string">'svg'</span>)</span><br><span class="line">              svg.appendChild(clone)</span><br><span class="line">              clone = svg;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          clone.setAttribute(<span class="string">"version"</span>, <span class="string">"1.1"</span>);</span><br><span class="line">          clone.setAttributeNS(xmlns, <span class="string">"xmlns"</span>, <span class="string">"http://www.w3.org/2000/svg"</span>);</span><br><span class="line">          clone.setAttributeNS(xmlns, <span class="string">"xmlns:xlink"</span>, <span class="string">"http://www.w3.org/1999/xlink"</span>);</span><br><span class="line">          clone.setAttribute(<span class="string">"width"</span>, width * options.scale);</span><br><span class="line">          clone.setAttribute(<span class="string">"height"</span>, height * options.scale);</span><br><span class="line">          clone.setAttribute(<span class="string">"viewBox"</span>, <span class="string">"0 0 "</span> + width + <span class="string">" "</span> + height);</span><br><span class="line">          outer.appendChild(clone);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">var</span> css = styles(el, options.selectorRemap);</span><br><span class="line">          <span class="keyword">var</span> s = <span class="built_in">document</span>.createElement(<span class="string">'style'</span>);</span><br><span class="line">          s.setAttribute(<span class="string">'type'</span>, <span class="string">'text/css'</span>);</span><br><span class="line">          s.innerHTML = <span class="string">"&lt;![CDATA[\n"</span> + css + <span class="string">"\n]]&gt;"</span>;</span><br><span class="line">          <span class="keyword">var</span> defs = <span class="built_in">document</span>.createElement(<span class="string">'defs'</span>);</span><br><span class="line">          defs.appendChild(s);</span><br><span class="line">          clone.insertBefore(defs, clone.firstChild);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">var</span> svg = doctype + outer.innerHTML;</span><br><span class="line">          <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">              cb(svg, width,height);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>Then we can convert SVG with CSS to canvas through <em>canvg</em>.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">saveAsSVGWithStyle(svgElement.node(), &#123;&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(svgWithStyle, width, height)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">      canvas.width = scale * width;</span><br><span class="line">      canvas.height = scale * height;</span><br><span class="line">      canvg(canvas, svgWithStyle, &#123; scaleWidth: canvas.width, scaleHeight: canvas.height, ignoreDimensions: <span class="literal">true</span>, ignoreMouse: <span class="literal">true</span>, ignoreClear: <span class="literal">true</span> &#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></p>
<p>When I tested on different browsers. I found that IE9 doesn’t support  SVG <strong>defs</strong>. So I can’t just define <em>defs and put CSS in defs</em>. I have to add style property to the SVG manually like this.<br><strong>If you have a better solution to make external CSS into the DOM style property, let me know, thank you.</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _appendStylesToSVG = <span class="function"><span class="keyword">function</span> <span class="params">(svgElement)</span> </span>&#123;</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis'</span>).style(<span class="string">'pointer-events'</span>, <span class="string">'none'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis path'</span>).style(<span class="string">'fill'</span>, <span class="string">'none'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis path'</span>).style(<span class="string">'stroke'</span>, <span class="string">'rgb(204, 204, 204)'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis path'</span>).style(<span class="string">'stroke-opacity'</span>, <span class="string">'0.75'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis path'</span>).style(<span class="string">'shape-rendering'</span>, <span class="string">'crispedges'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis path.domain'</span>).style(<span class="string">'stroke-opacity'</span>, <span class="string">'0.75'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis.nv-x path.domain'</span>).style(<span class="string">'stroke-opacity'</span>, <span class="string">'0'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis line'</span>).style(<span class="string">'fill'</span>, <span class="string">'none'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis line'</span>).style(<span class="string">'stroke'</span>, <span class="string">'rgb(229, 229, 229)'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis line'</span>).style(<span class="string">'shape-rendering'</span>, <span class="string">'crispedges'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-axis .zero line, .nvd3 .nv-axis line.zero'</span>).style(<span class="string">'stroke-opacity'</span>, <span class="string">'0.75'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-multibar .nv-groups rect'</span>).style(<span class="string">'stroke-opacity'</span>, <span class="string">'0'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-multibar .nv-groups rect'</span>).style(<span class="string">'transition'</span>, <span class="string">'fill-opacity 250ms linear 0s'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-multibarHorizontal .nv-groups rect'</span>).style(<span class="string">'stroke-opacity'</span>, <span class="string">'0'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-multibarHorizontal .nv-groups rect'</span>).style(<span class="string">'transition'</span>, <span class="string">'fill-opacity 250ms linear 0s'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-discretebar .nv-groups rect'</span>).style(<span class="string">'stroke-opacity'</span>, <span class="string">'0'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nvd3 .nv-discretebar .nv-groups rect'</span>).style(<span class="string">'transition'</span>, <span class="string">'fill-opacity 250ms linear 0s'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.nv-x .tick line'</span>).style(<span class="string">'display'</span>, <span class="string">'none'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.statistics-title'</span>).style(<span class="string">'fill'</span>, <span class="string">'rgba(107, 156, 188, 1)'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.statistics-title'</span>).style(<span class="string">'font-size'</span>, <span class="string">'21px'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.statistics-title'</span>).style(<span class="string">'font-weight'</span>, <span class="string">'300'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.statistics-title-total'</span>).style(<span class="string">'font-size'</span>, <span class="string">'14px'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.statistics-title-total'</span>).style(<span class="string">'fill'</span>, <span class="string">'rgb(153, 153, 153)'</span>);</span><br><span class="line">    svgElement.selectAll(<span class="string">'.statistics-title-total'</span>).style(<span class="string">'font-weight'</span>, <span class="string">'300'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h3 id="Step_2:_downloading_PNG">Step 2: downloading PNG</h3><p>We have to support IE9, but IE9 doesn’t support html5 file API. So I did a trik, I sent  base64 string of the image to server-side, server-side would generate a link to client-side, and then download it. The completed codes is<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$scope.exportToPNG = <span class="function"><span class="keyword">function</span> <span class="params">(chartId,scale)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> svgElement = d3.select(<span class="string">"#"</span> + chartId + <span class="string">" svg"</span>);</span><br><span class="line">    <span class="comment">//Append styles as there are some problems when drawing PNG on IE 9</span></span><br><span class="line">    _appendStylesToSVG(svgElement);</span><br><span class="line">    <span class="keyword">var</span> fileName = _buildPNGName(chartId);</span><br><span class="line">    scale = scale ? scale : <span class="number">1.5</span>;</span><br><span class="line"></span><br><span class="line">    saveAsSVGWithStyle(svgElement.node(), &#123;&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(svgWithStyle, width, height)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">        canvas.width = scale * width;</span><br><span class="line">            canvas.height = scale * height;</span><br><span class="line">            canvg(canvas, svgWithStyle, &#123; scaleWidth: canvas.width, scaleHeight: canvas.height, ignoreDimensions: <span class="literal">true</span>, ignoreMouse: <span class="literal">true</span>, ignoreClear: <span class="literal">true</span> &#125;);</span><br><span class="line">            <span class="keyword">var</span> imageData = canvas.toDataURL(<span class="string">"image/png"</span>);</span><br><span class="line">            imageData = imageData.replace(<span class="regexp">/^data:image\/(png|jpg);base64,/</span>, <span class="string">""</span>);</span><br><span class="line">            statisticalChartsService.saveChartCache(imageData).then(<span class="function"><span class="keyword">function</span> <span class="params">(response)</span> </span>&#123;</span><br><span class="line">                statisticalChartsService.getChartCache(fileName, response.data);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="Conclusion">Conclusion</h2><p>If you’d like to export SVG to PNG on the server-side, <strong>PhantomJs</strong> is a good choise. If you’d like to SVG to PNG on the client-side, you can use <strong>canvg</strong>.  But for <strong>nvd3</strong>, you have to figure out how to add external CSS class to SVG.</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/javascript/">javascript</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/angularjs/">angularjs</a>, <a href="/tags/canvg/">canvg</a>, <a href="/tags/chart/">chart</a>, <a href="/tags/d3/">d3</a>, <a href="/tags/nvd3/">nvd3</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/NET/">.NET</a><small>2</small></li>
  
    <li><a href="/categories/English/">English</a><small>4</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/javascript/">javascript</a><small>4</small></li>
  
    <li><a href="/categories/shell/">shell</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/ESL/">ESL</a><small>4</small></li>
  
    <li><a href="/tags/OWIN/">OWIN</a><small>1</small></li>
  
    <li><a href="/tags/Phantomjs/">Phantomjs</a><small>1</small></li>
  
    <li><a href="/tags/angularjs/">angularjs</a><small>4</small></li>
  
    <li><a href="/tags/canvg/">canvg</a><small>1</small></li>
  
    <li><a href="/tags/chart/">chart</a><small>2</small></li>
  
    <li><a href="/tags/d3/">d3</a><small>2</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/mac/">mac</a><small>1</small></li>
  
    <li><a href="/tags/ng-gird/">ng-gird</a><small>1</small></li>
  
    <li><a href="/tags/nvd3/">nvd3</a><small>2</small></li>
  
    <li><a href="/tags/shell/">shell</a><small>2</small></li>
  
    <li><a href="/tags/ssh/">ssh</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Hui
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'dixon629githubio';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>